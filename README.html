<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>BMSQRM&colon; Bayesian Monotone Single-index Quantile Regression Model with Bounded Responses and Misaligned Functional Covariates</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="bmsqrm-bayesian-monotone-single-index-quantile-regression-model-with-bounded-responses-and-misaligned-functional-covariates">BMSQRM: Bayesian Monotone Single-index Quantile Regression Model with Bounded Responses and Misaligned Functional Covariates</h1>
<h1 id="introduction">Introduction</h1>
<h2 id="abstract">Abstract</h2>
<p><strong>Existing mental health research indicates that increasing depressive symptoms in adolescents are linked to a parental history of depression, current anxiety, depressive symptoms, and other behavioral problems. Our objective is to explore the association between these scalar variables and multiple functional covariates measuring neural response to rewards with future adolescent depression. Unlike previous studies that employed simple linear regression to account for all covariates, we introduce a novel Bayesian quantile regression model. This model utilizes a single-index summary of all scalar and functional covariates, paired with a monotone link function to accommodate unknown functional forms and interactions among covariates. Our method addresses several practical challenges not covered by existing methods: it provides an index with clinical interpretability similar to a linear model, ensures the fitted value of the pre-specified quantile remains within the same bounds as the response, and accounts for the uncertainty in the registration of observed functional covariates during data analysis. In our simulation study, our method outperforms existing unrestricted single-index models in the presence of both scalar and pre-registered functional covariates. Additionally, we demonstrate the practical benefits and implications of our method by analyzing data from a large adolescent depression study, leading to a new statistically principled summary of the functional covariates measuring neural response to rewards.</strong></p>
<h1 id="code-usage">Code Usage</h1>
<h2 id="1-file-structure">1. File Structure</h2>
<ul>
<li><strong><a href="simu_main.R">simu_main.R</a>:</strong>
<ul>
<li>the main function for implementing the simulation analysis</li>
</ul>
</li>
<li><strong><a href="simu_data_gen.R">simu_data_gen.R</a></strong>
<ul>
<li>the main function for generating the simulation dataset</li>
</ul>
</li>
<li><strong><a href="main_process.R">main_process.R</a>:</strong>
<ul>
<li>the main algorithm for our method BMSQRM, containing iterative (registration + MCMC Sampling)</li>
</ul>
</li>
<li><strong><a href="MCMC_sampling.R">MCMC_sampling.R</a>:</strong>
<ul>
<li>the main functions for MCMC Sampling</li>
</ul>
</li>
<li><strong><a href="logLikelihood.cpp">logLikelihood.cpp</a>:</strong>
<ul>
<li>the function for computing the log-likelihood, written in C++ for speed-up</li>
</ul>
</li>
<li><strong><a href="utilities.R">utilities.R</a>:</strong>
<ul>
<li>contains all other user-defined helper functions</li>
</ul>
</li>
<li><strong><a href="./figures/">./figures/</a></strong>
<ul>
<li><a href="./figures/curves_generation_spike_slab_v3.pdf">curves_generation_spike_slab_v3.pdf</a>: the illustration of curve generating process</li>
<li><a href="./figures/simu_fz_gamma_examples_v2.pdf">simu_fz_gamma_examples_v2.pdf</a>: the visualization of fitted link function and estimated functional coefficients in Simulation Analysis</li>
</ul>
</li>
</ul>
<h2 id="2-usage-of-main_processr">2. Usage of <a href="main_process.R">main_process.R</a>:</h2>
<h3 id="input-structure">Input Structure:</h3>
<ul>
<li><strong>x</strong>: scalar predictors, (p,n)</li>
<li><strong>y</strong>: response, (n)</li>
<li><strong>curves</strong>: functional predictors, (N, n, nf)</li>
<li><strong>t</strong>: index of the curves, (N)</li>
<li><strong>tau</strong>: the quantile level to be examined</li>
<li><strong>registration</strong>: bool, if conduct the registration iteratively together with MCMC</li>
<li><strong>srvf.lambda</strong>: control the level of penalty in the elastic registration</li>
<li><strong>showplot.srvf</strong>: bool, visualize the detailed process of registration</li>
<li><strong>curves.template</strong>: the template used in the elastic registration,
<ul>
<li>a matrix (N, nf),</li>
<li>or vector (nf) of integers denoting the index of curves as the template</li>
<li>or string &quot;median&quot;/&quot;mean&quot; denoting the Karcher Median/Mean as the template</li>
</ul>
</li>
<li><strong>norder</strong>: the order of B-Splines for the functional coeffficients</li>
<li><strong>nbasis</strong>: the number of basis of B-Splines for the functional coefficients</li>
<li><strong>K</strong>: the number of gaussian cdfs used in estimating the link function</li>
<li><strong>seed</strong>: for random number generator</li>
<li><strong>n.chains</strong>: the number of MCMC chains to obtain the estimators</li>
<li><strong>Nsamples</strong>: the number of samples obtained in each chain</li>
<li><strong>slice.w</strong>: the window size in the slice sampler, a scalar or a list of window size for each parameter</li>
<li><strong>slice.m</strong>: the max number of steps within the slice sampler</li>
</ul>
<h4 id="hyperparamters">Hyperparamters:</h4>
<ul>
<li><strong>a.sigma, b.sigma</strong>: the prior of sigma</li>
<li><strong>a.DP</strong>: the prior of B</li>
<li><strong><a href="http://mean.mu">mean.mu</a>, <a href="http://sd.mu">sd.mu</a></strong>: the prior of each mu_j in mixture gaussian cdf</li>
<li><strong>shape.xi, scale.xi</strong>: the prior of each xi_j in mixture gaussian cdf</li>
<li><strong>scale.eta</strong>: the parameter in the prior of eta_{k,b}</li>
</ul>
<h4 id="others">Others</h4>
<ul>
<li><strong>burnin &amp; thinning</strong>: number of samples to discard and thinning in each chain</li>
<li><strong>psrf, autocorr, trace, density, effsize, effsize.fz</strong>: bool, for chain diagnosis, check R package &quot;coda&quot; for more details</li>
<li><strong>max_iters</strong>: the max number of iterations for the whole process</li>
<li><strong>save.samples</strong>: bool, whether to save all the samples in each chain, (will always save the effective samples)</li>
<li><strong>r</strong>: the constraint (2-norm) of scalar coefficients</li>
<li><strong>p.kl</strong>: in (0,1), control the sparsity level of beta</li>
</ul>
<h4 id="note">Note:</h4>
<pre><code>n: sample size
N: number of grids for curves
p: number of scalar predictors
nf: number of functional predictors
</code></pre>
<h3 id="output-structure">Output Structure:</h3>
<blockquote>
<p><strong>a list containing the following attributes:</strong></p>
</blockquote>
<ul>
<li>
<blockquote>
<p><strong>res.list0: a list containing the final estimates after convergence</strong></p>
</blockquote>
<ul>
<li>res0: a list containing the effective samples and Bayesian estimates for each chain</li>
<li>all.chains: a list containing the mcmc chains after burnin &amp; thinning for each chain</li>
<li>all.estimators: a list containing the Bayesian estimates for each chain</li>
<li>paras.init: a list containing the initial values for each parameter</li>
<li>sigma.est</li>
<li>theta.est</li>
<li>alpha.est</li>
<li>beta.est</li>
<li>z.est</li>
<li>fz.est</li>
<li>b.est</li>
<li>mu.est</li>
<li>xi.est</li>
</ul>
</li>
<li><strong>iters</strong>: the number of iterations running (registration + MCMC) procedure</li>
<li><strong>all.alpha.est</strong>: a (iters, p) matrix, each row contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">α</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{\boldsymbol{\alpha}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7079em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">α</span></span></span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span></span></span></span></span></span></span> after one iteration of (registration + MCMC) procedure</li>
<li><strong>all.beta.est</strong>: a (iters, nbasis*nf) matrix, each row contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi mathvariant="bold-italic">β</mi><mo>^</mo></mover></mrow><annotation encoding="application/x-tex">\hat{\boldsymbol{\beta}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1523em;vertical-align:-0.1944em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol" style="margin-right:0.03403em;">β</span></span></span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span></span></span></span> after one iteration of (registration + MCMC) procedure</li>
<li><strong>all.gamma.est</strong>: a (N, nf, iters) array, each slice contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mover accent="true"><mi>γ</mi><mo>^</mo></mover><mn>1</mn></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mover accent="true"><mi>γ</mi><mo>^</mo></mover><mn>2</mn></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\hat{\gamma}_1(t), \hat{\gamma}_2(t))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">))</span></span></span></span> after one iteration of (registration + MCMC) procedure</li>
<li><strong>all.curves.reg</strong>: a list containing the registered curves for each iteration</li>
<li><strong>all.z.est</strong>: a (iters, n) matrix, each row contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>z</mi><mo>^</mo></mover><mi>i</mi></msub><mo separator="true">,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\hat{z}_i, i=1,\ldots,n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> after one iteration of (registration + MCMC) procedure</li>
<li><strong>all.fz.est</strong>: a (iters, n) matrix, each row contains <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>f</mi><mo>^</mo></mover><mo stretchy="false">(</mo><msub><mover accent="true"><mi>z</mi><mo>^</mo></mover><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\hat{f}(\hat{z}_i), i=1,\ldots, n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2079em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span> after one iteration of (registration + MCMC) procedure</li>
</ul>
<h2 id="3-an-example-of-simulation-analysis-simu_mainr">3. An Example of Simulation Analysis: <strong><a href="simu_main.R">simu_main.R</a></strong></h2>
<h3 id="a-arguments">(a) Arguments:</h3>
<ul>
<li>n: sample size</li>
<li>N: number of grids</li>
<li>tau: target quantile level</li>
<li>func.p: bool, whether include functional covariates</li>
<li>fz.idx: choice of link function
<ul>
<li>fz.idx = 1: CDF of Gaussian distribution</li>
<li>fz.idx = 2: CDF of Laplace distribution</li>
<li>fz.idx = 3: CDF of Pareto distribution</li>
</ul>
</li>
<li>K: number of mixture gaussian cdfs used to model the link function</li>
<li>n.chains: number of MCMC chains in each iteration</li>
<li>Nsamples: number of samples to draw from each chain</li>
<li>burnin</li>
<li>thinning</li>
<li>max_iters: maximum number of iterations running (registration + MCMC) procedure</li>
<li>jobid: an index for replication purpose &amp; parallel computing, used as the seed in data generation</li>
<li>save.samples: bool, if save all the samples or only the effecitve samples after burnin &amp; thinning</li>
<li>visualize.results: bool, if generate the visualization of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mover accent="true"><mi>γ</mi><mo>^</mo></mover><mn>1</mn></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mover accent="true"><mi>γ</mi><mo>^</mo></mover><mn>2</mn></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(\hat{\gamma}_1(t), \hat{\gamma}_2(t))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0556em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">))</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>f</mi><mo>^</mo></mover><mo stretchy="false">(</mo><msub><mover accent="true"><mi>z</mi><mo>^</mo></mover><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\hat{f}(\hat{z}_i), i=1,\ldots, n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2079em;vertical-align:-0.25em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6944em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span></span></span></span>.</li>
</ul>
<blockquote>
<p><strong>The following arguments will only be used while existing functional covariates, i.e., func.p = TRUE</strong></p>
</blockquote>
<ul>
<li>nbasis: number of B-Spline basis for the functional coefficients</li>
<li>nf: number of functional covariates</li>
<li>p.kl: the prior parameter controlling the sparsity of functional coefficients</li>
<li>registration: bool, wheter to conduct (registration + MCMC) or only MCMC</li>
<li>srvf.lambda: a scalar in (0,1), controlling the smoothness in the registration step</li>
</ul>
<h3 id="b-examples-of-usage">(b) Examples of Usage</h3>
<h4 id="i-simulation-setting-i2-described-in-the-paper--only-scalar-covariates">(i) Simulation Setting I.2 described in the paper, <mark> only scalar covariates<mark></h4>
<blockquote>
<p>n = 200, N = 100, tau = 0.50, func.p = FALSE, fz.idx = 2 (Laplace CDF), K = 10, n.chains = 1, Nsamples = 1E5, burnin = 5E4, thinning = 20, max_iters = 5, jobid = 1, save.samples = FALSE, visualize.results = FALSE, nbasis = 9, nf = 2, p.kl = 0.5, registration = FALSE, srvf.lambda = 0.05</p>
</blockquote>
<pre><code class="language-ruby">R <span class="hljs-variable constant_">CMD</span> <span class="hljs-variable constant_">BATCH</span> simu_main.R <span class="hljs-number">200</span> <span class="hljs-number">100</span> <span class="hljs-number">0.5</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-number">2</span> <span class="hljs-number">10</span> <span class="hljs-number">1</span> <span class="hljs-number">1E5</span> <span class="hljs-number">5E4</span> <span class="hljs-number">20</span> <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-number">9</span> <span class="hljs-number">2</span> <span class="hljs-number">0.5</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">0.05</span>
</code></pre>
<h4 id="ii-simulation-setting-ii1-described-in-the-paper--both-scalar-and-functional-covariates">(ii) Simulation Setting II.1 described in the paper, <mark> both scalar and functional covariates<mark></h4>
<blockquote>
<p>n = 200, N = 100, tau = 0.75, func.p = TRUE, fz.idx = 2 (Laplace CDF), K = 10, n.chains = 1, Nsamples = 1E5, burnin = 6E4, thinning = 100, max_iters = 5, jobid = 1, save.samples = FALSE, visualize.results = TRUE, nbasis = 9, nf = 2, p.kl = 0.5, registration = TRUE, srvf.lambda = 0.05</p>
</blockquote>
<pre><code class="language-ruby">R <span class="hljs-variable constant_">CMD</span> <span class="hljs-variable constant_">BATCH</span> simu_main.R <span class="hljs-number">200</span> <span class="hljs-number">100</span> <span class="hljs-number">0.75</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">2</span> <span class="hljs-number">10</span> <span class="hljs-number">1</span> <span class="hljs-number">1E5</span> <span class="hljs-number">6E4</span> <span class="hljs-number">100</span> <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">9</span> <span class="hljs-number">2</span> <span class="hljs-number">0.5</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">0.05</span>
</code></pre>
<h4 id="iii-simulation-setting-ii2-described-in-the-paper--both-scalar-and-functional-covariates-without-registration">(iii) Simulation Setting II.2 described in the paper, <mark> both scalar and functional covariates, <strong>without registration</strong><mark></h4>
<blockquote>
<p>n = 200, N = 100, tau = 0.50, func.p = TRUE, fz.idx = 3 (Pareto CDF), K = 10, n.chains = 1, Nsamples = 1E5, burnin = 6E4, thinning = 100, max_iters = 5, jobid = 1, save.samples = FALSE, visualize.results = TRUE, nbasis = 9, nf = 2, p.kl = 0.5, registration = FALSE, srvf.lambda = 0.05</p>
</blockquote>
<pre><code class="language-ruby">R <span class="hljs-variable constant_">CMD</span> <span class="hljs-variable constant_">BATCH</span> simu_main.R <span class="hljs-number">200</span> <span class="hljs-number">100</span> <span class="hljs-number">0.5</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">3</span> <span class="hljs-number">10</span> <span class="hljs-number">1</span> <span class="hljs-number">1E5</span> <span class="hljs-number">6E4</span> <span class="hljs-number">100</span> <span class="hljs-number">5</span> <span class="hljs-number">1</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-variable constant_">TRUE</span> <span class="hljs-number">9</span> <span class="hljs-number">2</span> <span class="hljs-number">0.5</span> <span class="hljs-variable constant_">FALSE</span> <span class="hljs-number">0.05</span>
</code></pre>
<h3 id="3-visualization">3. Visualization</h3>
<h4 id="a-illustration-of-curve-generating-process">(a) Illustration of curve generating process</h4>
<details>
    <summary>Curve Generating Process</summary>
<pre><code>![Curve Generating Process](./figures/curves_generation_spike_slab_v3.pdf)

Fig 1. Simulated initial curves $\{c_{1,i}^{(0)}\}_{i=1}^n$ (Panel A) and $\{c_{2,i}^{(0)}\}_{i=1}^n$ (Panel D); perfectly registered functional covariates $\{c_{1,i}^*(t)\}_{i=1}^n$ (Panel B) and $\{c_{2,i}^*(t)\}_{i=1}^n$ (Panel E); and ``observed&quot; unregistered functional covariates $\{c_{1,i}(t)\}_{i=1}^n$ (Panel C) and $\{c_{2,i}(t)\}_{i=1}^n$ (Panel F).
</code></pre>
</details>
<h3 id="a-to-visualize-the-preprocessing-steps-of-the-signals">(a) To visualize the preprocessing steps of the signals,</h3>
<pre><code>python visualization_preprocess.py 
</code></pre>
<h3 id="b-to-check-the-model-performance-and-attention-weights-analysis">(b) To check the model performance and attention weights analysis,</h3>
<pre><code>python results_analysis.py 
</code></pre>
<p><strong>Model_performance.ipynb</strong> presents the performance comparison.</p>
<details>
  <summary>The top 100 important features</summary>
<p><img src="file:////figures/top100features.jpg" alt="top100features"></p>
<p>Fig 4. The top 100 important features sorted by the logarithm-scale importance gain. The local-scale features are highlighted in blue, while the global-scale
features are indicated in red.</p>
</details>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>